# =============================================================================
# SNOWUI TRANSLATION WRAPPER - PRODUCT REQUIREMENTS DOCUMENT
# =============================================================================
# 
# VERSION: 3.1
# LAST UPDATED: 2026-01-16
# STATUS LEGEND: [DONE] = Completed | [PARTIAL] = In Progress | [PLANNED] = Not started
#
# =============================================================================


# =============================================================================
# SECTION 1: PROJECT OVERVIEW
# =============================================================================

## 1.1 PRODUCT DESCRIPTION
--------------------------------------------------------------------------------
Product Name: SnowUI Translation Wrapper
Objective: Internal CMS for managing multilingual content (English, Bahasa Malaysia, 
Chinese) with a streamlined "Human-in-the-Loop" workflow.

Target Users:
- Internal Marketing & Product Teams (Editors)
- Team Leads (Managers)

## 1.2 SUPPORTED LANGUAGES
--------------------------------------------------------------------------------
| Code | Language             | Role           |
|------|----------------------|----------------|
| EN   | English              | Primary/Source |
| MY   | Bahasa Malaysia      | Target         |
| ZH   | Simplified Chinese   | Target         |

## 1.3 TECHNOLOGY STACK
--------------------------------------------------------------------------------
| Layer      | Technology                          |
|------------|-------------------------------------|
| Frontend   | React + Vite + TailwindCSS + ShadCN |
| Backend    | Firebase (Firestore, Auth)          |
| AI         | Google Gemini API (@google/genai)   |
| Files      | xlsx library (Excel import/export)  |


# =============================================================================
# SECTION 2: USER ROLES & PERMISSIONS
# =============================================================================

## 2.1 EDITOR (Translator/Copywriter) [DONE]
--------------------------------------------------------------------------------
Goal: Efficiently translate content and submit for review.

Permissions:
- View assigned projects/pages
- Edit content in target language columns (Bahasa/Chinese)
- Use AI generation tools ("Magic Fill" / Translate)
- Select Prompt Category (Dropdown) in translation table
- View Prompt Guidelines (Tooltip only)
- Action: "Submit for Review" (cannot "Approve" or "Export")

Constraints:
- Cannot edit rows in "Pending Review" or "Approved" status

## 2.2 MANAGER (Reviewer/Admin) [DONE]
--------------------------------------------------------------------------------
Goal: Ensure quality, consistency, and deployment readiness.

Permissions:
- Create/Delete Projects and Pages
- Create/Delete Projects and Pages
- Manage Glossary and Team Settings
- Full Access to Prompt Library (Create/Edit Categories & Global Default)
- Action: "Approve" or "Request Changes" on submitted rows
- Action: "Export" or "Publish" final content


# =============================================================================
# SECTION 3: DASHBOARD (Command Center)
# =============================================================================

## 3.1 PULSE CARDS (Top Row) [PLANNED]
--------------------------------------------------------------------------------
Purpose: Immediately answer "What needs attention?"

| Card | Data | Priority |
|------|------|----------|
| Approvals Waiting | Count of "Pending Review" status | Manager |
| Translation Health | % approved vs total content | All |
| My Tasks | Count of "Changes Requested" items | Editor |

## 3.2 ACTION WIDGETS [PARTIAL]
--------------------------------------------------------------------------------
| Widget | Description | Status |
|--------|-------------|--------|
| Task List | "Assigned to Me" table | [PLANNED] |
| Recent Projects | Quick access to last 5 pages | [DONE] (in sidebar) |


# =============================================================================
# SECTION 4: NAVIGATION & STRUCTURE
# =============================================================================

## 4.1 GLOBAL NAVIGATION [DONE]
--------------------------------------------------------------------------------
Fixed Left Sidebar with items:
- Overview
- Projects
- Glossary
- Approvals
- Translate
- Prompt Library
- Settings (collapsible with sub-items)

Active State: Pink highlighted background (bg-pink-50 text-pink-600)

## 4.2 BREADCRUMBS [PARTIAL]
--------------------------------------------------------------------------------
Format: Home > Projects > 5G Advanced > Prepaid
Requirement: Must persist even with sidebar to show hierarchy depth.

## 4.3 PROJECT HIERARCHY [DONE]
--------------------------------------------------------------------------------
Structure:
- Projects (Folder Level, e.g., "5G Advanced")
  ‚îî‚îÄ‚îÄ Pages (File Level, e.g., "Prepaid Page")

Data Model:
projects/
‚îú‚îÄ‚îÄ {projectId}
‚îÇ   ‚îú‚îÄ‚îÄ name: string
‚îÇ   ‚îú‚îÄ‚îÄ status: string
‚îÇ   ‚îî‚îÄ‚îÄ pages/ (subcollection)
‚îÇ       ‚îî‚îÄ‚îÄ {pageId}
‚îÇ           ‚îú‚îÄ‚îÄ name: string
‚îÇ           ‚îî‚îÄ‚îÄ rows: array

## 4.4 PROJECT OVERVIEW PAGE [PLANNED]
--------------------------------------------------------------------------------
When clicking parent project, display:
- List of sub-pages as Cards
- Project-level progress bar
- "+ Create New Page" button (Primary Action)


# =============================================================================
# SECTION 5: TRANSLATION EDITOR (Core UI)
# =============================================================================

## 5.1 LAYOUT [DONE]
--------------------------------------------------------------------------------
Spreadsheet-style view with columns:
| Source (EN) | Target 1 (MY) | Target 2 (ZH) | Status | Prompt | Actions |

## 5.2 TOOLBAR [PARTIAL]
--------------------------------------------------------------------------------
Layout: [Search Input] (Far Left) ... [Filter] [Sort] (Far Right)

| Feature | Status |
|---------|--------|
| Search | [DONE] |
| Filter button | [DONE] |
| Sort by column | [PARTIAL] |

## 5.3 TRANSLATION WORKFLOW
--------------------------------------------------------------------------------
Three-level translation system with progressive granularity:

### LEVEL 1: Magic Fill (Initial) [PARTIAL]
- Trigger: New project or "Magic Fill" button
- Scope: Only empty cells (skips already-filled translations)
- Prompt: Uses Default prompt
- Status: draft ‚Üí review after fill
- Glossary: Injects approved glossary terms

### LEVEL 2: Batch Regeneration [PARTIAL]
- Trigger: Select rows ‚Üí Click "Regenerate" in floating action bar
- Scope: All selected rows (both MY and ZH)
- Prompt: User can select different prompt before regenerating
- UI: Floating bar shows prompt dropdown + Regenerate button

### LEVEL 3: Cell-Level Regeneration [PLANNED]
- Trigger: Hover cell ‚Üí Click sparkle ‚ú® icon
- Scope: Single cell (one language only: MY or ZH)
- Prompt: Uses row's assigned promptId
- UI: Sparkle appears on hover, loading spinner during generation

### Supporting Features
| Feature | Description | Status |
|---------|-------------|--------|
| Focus Mode | Hide specific columns | [PLANNED] |
| Ghost Row | Permanent empty row at bottom | [PLANNED] |
| Glossary Highlights | Highlight terms from glossary (pink) | [DONE] |
| Inline Add Row | Add row without popup | [DONE] |

## 5.4 STATUS INDICATORS [PARTIAL]
--------------------------------------------------------------------------------
| Status | Icon | Color | Editable |
|--------|------|-------|----------|
| Draft | ‚ö™ | Gray | Yes |
| Pending Review | üü† | Orange | No (Editor) |
| Approved | üü¢ | Green | No |
| Changes Requested | üî¥ | Red | Yes |


# =============================================================================
# SECTION 6: WORKFLOW REQUIREMENTS
# =============================================================================

## 6.1 DRAFTING PHASE [DONE]
--------------------------------------------------------------------------------
- Users can save work without notifying manager
- Users can select specific rows via checkboxes (Batch Selection)
- Default new row: status='draft', promptId='default'

## 6.2 SUBMISSION PHASE [PLANNED]
--------------------------------------------------------------------------------
Requirement: "Submit for Review" button appears when items are selected.

Logic:
1. User selects rows
2. User clicks "Submit"
3. System validates (checks for empty cells)
4. Status changes to "Pending Review"
5. Rows become Read-Only for Editor

## 6.3 REVIEW PHASE [PARTIAL]
--------------------------------------------------------------------------------
| Feature | Status |
|---------|--------|
| Manager views pending in Approvals tab | [DONE] |
| Approve button (single click) | [DONE] |
| Request Changes with comment | [PLANNED] |
| Diff View for re-submissions | [PLANNED] |

## 6.4 DEPLOYMENT [PLANNED]
--------------------------------------------------------------------------------
- "Export" button disabled until 100% approved
- Manager override with warning confirmation


# =============================================================================
# SECTION 7: GLOSSARY MANAGEMENT
# =============================================================================

## 7.1 CORE FEATURES [DONE]
--------------------------------------------------------------------------------
- CRUD operations (Add, Edit, Delete terms)
- Category management
- Bulk import from Excel
- Glossary injection into translation prompts
- Status field: pending/approved (only approved used in AI)

## 7.2 EDITOR INTEGRATION [DONE]
--------------------------------------------------------------------------------
- Glossary terms highlighted in pink in Project Details table
- Uses `GlossaryHighlighter` component (reused from Quick Check)
- Hover tooltip shows mandatory translation


# =============================================================================
# SECTION 8: PROMPT ENGINEERING
# =============================================================================

## 8.1 INHERITANCE LOGIC ("The Layer Cake") [DONE]
--------------------------------------------------------------------------------
Implemented Model:
1. Layer 1: Global Default (The Base)
   - ALWAYS used for ALL translations.
   - Example: "Professional tone, formal rules, glossary usage."
   - Editable ONLY by Manager.

2. Layer 2: Category (The Flavor)
   - APPENDED to Global Default (not replaced).
   - Example: "Banner Mode: Short, punchy."
   - Selectable by Editor per-row.

Final Prompt sent to AI = [Global Default] + [Category Specific Instructions]

## 8.2 GROUPED TRANSLATION [DONE]
--------------------------------------------------------------------------------
When translating mixed selections:
- Rows grouped by their promptId
- Each group translated with its respective merged prompt
- Separate API calls per prompt group
- Example: 3 rows with "B" + 2 rows with "Default" = 2 API calls

## 8.2 ROLE-BASED ACCESS [PLANNED]
--------------------------------------------------------------------------------
| Feature | Editor (User) | Manager (Admin) |
| --- | --- | --- |
| Select Category | ‚úÖ Yes (Dropdown) | ‚úÖ Yes |
| View Prompt Text | üëÅÔ∏è Read-only (Tooltip) | ‚úèÔ∏è View & Edit |
| Edit "Default" | ‚ùå No | ‚úÖ Yes (Critical) |
| Create Category | ‚ùå No | ‚úÖ Yes |

## 8.3 UI IMPLEMENTATION [PLANNED]
--------------------------------------------------------------------------------
Manager View (Prompt Library):
- Left Sidebar: List of prompts including fixed "Global System Prompt"
- Main Area: Edit interface for selected prompt

Editor View (Translation Table):
- Prompt Column: Dropdown implementation
- Interaction: Hover over pill ‚Üí Tooltip shows "Guideline" text (not raw prompt)
- Restriction: No edit access to text.


# =============================================================================
# SECTION 9: EXCEL IMPORT/EXPORT
# =============================================================================

## 9.1 IMPORT [DONE]
--------------------------------------------------------------------------------
- Multi-sheet parsing
- Column mapping UI
- Creates project with parsed rows

## 9.2 EXPORT [PARTIAL]
--------------------------------------------------------------------------------
- Basic export functionality [DONE]
- Conditional export (100% approved) [PLANNED]
- Force export with warning [PLANNED]


# =============================================================================
# SECTION 10: VERSION HISTORY
# =============================================================================

v3.1 (2026-01-16):
- Implemented prompt merging: custom prompts append to default
- Added grouped translation by promptId
- Implemented glossary highlighting in Project Details
- Fixed Bahasa Malaysia prompt instructions being ignored
- Created reusable GlossaryHighlighter component

v3.0 (2026-01-11):
- Restructured to SnowUI PRD format
- Added workflow phases (Drafting, Submission, Review, Deployment)
- Added pulse cards and dashboard requirements
- Added Focus Mode, Ghost Row, Glossary Highlights specs
- Added conditional export requirements

v2.2 (2026-01-11):
- SnowUI project page updates
- Pink sidebar highlight
- Empty state UI
- Default row values
- Inline row addition

v2.1 (2026-01-08):
- Refined requirements document
- Added structured sections

v2.0 (2026-01-08):
- Centralized Approval Dashboard
- Gemini API integration
- Security audit

v1.0 (2026-01-06):
- Initial implementation


# =============================================================================
# END OF DOCUMENT
# =============================================================================
